function Data(){Data._self=this,this.global_v_names={},this.all_v={},this.constraints=[],this.constraint_nodes=[],this.var_aliases={}}function DrawingEngine(){DrawingEngine._self=this,this.width=window.innerWidth-20,this.height=window.innerHeight-20,this.cola_obj=cola.d3adaptor().size([this.width,this.height]),window.addEventListener("resize",function(){DrawingEngine._self.svg.attr("width",window.innerWidth-20),DrawingEngine._self.svg.attr("height",window.innerHeight-20)})}function hasClass(a,b){return new RegExp(" "+b+" ").test("  "+a.className+" ")}function addClass(a,b){hasClass(a,b)||(a.className+=" "+b)}function removeClass(a,b){var c=" "+a.className.replace(/[\t\r\n]/g," ")+" ";if(hasClass(a,b)){for(;c.indexOf(" "+b+" ")>=0;)c=c.replace(" "+b+" "," ");a.className=c.replace(/^\s+|\s+$/g,"")}}function VarLayout(){VarLayout._self=this,this.model_nodes={},this.isReady=!0,this.horizontally=!1,this.height=window.innerHeight-20}function VarLayout(){this.variables,this.new_variables,this.context,this.canvas,this.file_name,this.show_introduced=!0}function read_variables(a){variables=[];for(i in a){var b=a[i].indexOf("INTVAR:");if(!(0>b)){var c=a[i].substring(b+7).trim().split(" ");variables[i]={name:c[0],id:i,occurs:0},var_map[c[0]]=variables[i]}}console.log("--- variables ids have been read",variables)}function read_varlits(a){map_varlits={};for(i in a){var b=a[i].indexOf("VARLITS:");if(!(0>b)){var c=a[i].substring(b+8),d=c.trim().split(" "),e=d[0].indexOf("[");if(e>=0)for(var f=d[0].substr(e+1,d[0].length-e-3),g=1;g<d.length;g++)map_varlits[Math.abs(parseInt(d[g]))]=variables[f]}}console.log("--- varlits have been read",map_varlits)}function read_clauses(a){clauses=[];for(i in a){var b=a[i].indexOf("CLAUSE:");if(!(0>b)){var c=a[i].substring(b+8).split(" "),d=[];for(j in c){var e=map_varlits[Math.abs(parseInt(c[j]))];void 0===e?console.log("undefined variable detected: ",c[j]):d.push(e)}clauses.push(d)}}console.log("--- clauses have been read",clauses)}function generate_vars(){vLayout.new_variables={},console.log("variables: ",variables);for(i in variables){var a,b=variables[i].name,c=b.indexOf("["),d=b.indexOf("]"),e=b.substring(0,c),f=vLayout.new_variables[e];if(!f&&(f={},vLayout.new_variables[e]=f,f.id=variables[i].id,f.arr=[],-1!=c)){var a=b.substring(c+1,d).split(","),g=a.length;f.n=[],f.type="array",f.name=e,f.dims=g;for(var h=0;g>h;h++)f.n[h]=0}if(-1!=c){a=b.substring(c+1,d).split(","),g=a.length;var j={};j.indexes=[];for(u in a)j.indexes.push(parseInt(a[u]));j.id=variables[i].id,f.arr.push(j);for(var k=0;g>k;k++)f.n[k]<parseInt(a[k])&&(f.n[k]=parseInt(a[k]))}}console.log("new_variables: ",vLayout.new_variables)}function generate_graph(){for(d in variables){var a=variables[d];a.type="svar",nogood_shown_v.push(a)}for(d in clauses)for(var b=0;b<clauses[d].length;b++)for(var c=b+1;c<clauses[d].length;c++)void 0==clauses[d][c]&&console.log("ooops"),connect_nodes(clauses[d][b],clauses[d][c]);for(var d in links_map)nogood_links.push(links_map[d])}function connect_nodes(a,b){if(a!=b){var c,d=parseInt(a.id),e=parseInt(b.id);d>e&&(e=d+e,d=e-d,e-=d),var1=variables[parseInt(d)],var2=variables[parseInt(e)],void 0==links_map[d+" "+e]?(c={},c.source=var1,c.target=var2,c.real_target=variables[parseInt(e)],c.occurrence=1,c.length=DEFAULT_EDGE_LENGTH,links_map[d+" "+e]=c):(c=links_map[d+" "+e],c.occurrence+=1)}}function subtract_graph(a,b){function c(a){var b=a.source.name,c=a.target.name;return c>b?b+"_"+c:c+"_"+b}links_map={},result=[];for(var d=0;d<a.length;d++)links_map[c(a[d])]=a[d];for(d=0;d<b.length;d++)delete links_map[c(b[d])];for(d in links_map)result.push(links_map[d]);return result}function handle_dragndrop(){document.onmousemove=function(a){-1==me_prev_x?me_prev_x=a.x:(rel_x-=(me_prev_x-a.x)/scale,me_prev_x=a.x),-1==me_prev_y?me_prev_y=a.y:(rel_y-=(me_prev_y-a.y)/scale,me_prev_y=a.y),vLayout.update_drawing()},document.onmouseup=function(){me_prev_y=-1,me_prev_x=-1,document.onmousemove=null}}function handle_mousewheel(a){a.wheelDelta>0?(vLayout.context.scale(SCALE_FACTOR,SCALE_FACTOR),scale*=SCALE_FACTOR):(vLayout.context.scale(1/SCALE_FACTOR,1/SCALE_FACTOR),scale*=1/SCALE_FACTOR),vLayout.update_drawing()}function init(){de.init_svg(),document.getElementById("search_input").addEventListener("input",update_search),document.getElementById("filter_range").addEventListener("mouseup",update_filter),document.getElementById("splitter").addEventListener("mousedown",move_splitter),document.getElementById("rotate_btn").addEventListener("click",rotate_vlayout),document.getElementById("clear_selection_btn").addEventListener("click",DrawingEngine.clear_selection),document.getElementById("svg").addEventListener("mousedown",DragRect.content_mdown),document.getElementById("svg").addEventListener("mouseup",DragRect.content_mup),console.log(document.getElementById("search_input")),isRunInBrouser&&run_graph("data/radiation/radiation_02.fzn","data/radiation/radiation_02.dat")}function DragRect(){}function update_filter_label(a){document.getElementById("filter_label").innerHTML=a}function calc_max_occurrence(){max_occurrence=diff_links.reduce(function(a,b){return a>b.occurrence?a:b.occurrence}),console.log("max_occurrence: ",max_occurrence)}function count_var_occurrence(){diff_links.forEach(function(a){var b=a.source,c=a.target;b.occurs<a.occurrence&&(b.occurs=a.occurrence),c.occurs<a.occurrence&&(c.occurs=a.occurrence)}),min_occurrence=variables.reduce(function(a,b){return a>b.occurs&&b.name.indexOf("[")>0?b.occurs:a},Math.pow(2,53)),console.log("min occurrence: ",min_occurrence)}function capture_nodes(a,b,c,d){a>c&&(a=[c,c=a][0]),b>d&&(b=[d,d=b][0]),a-=transform.dx,c-=transform.dx,b-=transform.dy,d-=transform.dy,a/=transform.scale,c/=transform.scale,b/=transform.scale,d/=transform.scale;for(var e=DrawingEngine._filter_single_nodes(),f=0;f<e.length;f++){var g=e[f];g.x&&a<g.x&&g.x<c&&b<g.y&&g.y<d&&(DrawingEngine.highlight_var(g),DrawingEngine._update_highlighting(),DrawingEngine._draw_var_list())}}function rotate_vlayout(){vLayout.horizontally=!vLayout.horizontally,vLayout.update_drawing(),DrawingEngine._update_highlighting()}function move_splitter(){document.onmousemove=function(a){d3.select("#v_layout").attr("width",a.x-20+"px")},document.onmouseup=function(){document.onmousemove=null}}function run_graph(a,b){void 0===b?(difference_graph=!1,data.readFile(a,constr_graph_ready)):(difference_graph=!0,data.readFile(a,constr_graph_ready),data.readNogoodsFile(b,process_nogoods),vLayout=new VarLayout,vLayout.init(),vLayout.update_drawing())}function apply_graph(){difference_graph?(links=cola_links=diff_links=subtract_graph(nogood_links,model_links),shown_v=nogood_shown_v,calc_max_occurrence(),count_var_occurrence()):(links=cola_links=model_links,shown_v=[].concat(model_shown_v,data.constraint_nodes))}function update_search(a){var b=a.target.value;""===b&&(b="^$");try{var c=new RegExp(b)}catch(a){return}DrawingEngine.set_all_unhighlighted(),DrawingEngine._filter_single_nodes().forEach(function(a){(c.test(a.name)||b==a.name)&&DrawingEngine.highlight_var(a)}),DrawingEngine._update_highlighting()}function update_filter(a){apply_filter(a.target.valueAsNumber)}function apply_filter(a){var b=max_occurrence-a*max_occurrence/100;links=cola_links=diff_links.filter(function(a){return a.occurrence>=b}),update_filter_label(Math.round(b)),de.draw()}function log_to_html(a){d3.select("body").append("p").text(a)}function echo(a){return a}function initialize(){}function init_string(a){de.init_svg(),data.readString(a,constr_graph_ready)}function constr_graph_ready(){isRunInBrouser&&(console.log("global_v_names: ",data.global_v_names),console.log("all_v: ",data.all_v)),difference_graph?construct_graph_o2():(construct_graph(),apply_graph(),de.draw())}function expand_node(a){a.isCollapsed=!1,construct_graph(),de.draw()}function collapse_node(a){a.isCollapsed=!0,construct_graph(),de.draw()}function construct_graph_o2(){if(model_shown_v=[],0===model_shown_v.length)for(var a in data.all_v){var b=data.all_v[a];b.type="svar",model_shown_v.push(b)}create_links_o2()}function process_nogoods(a){console.log("nogoods: ",a)}function construct_graph(){if(model_shown_v=[],0===model_shown_v.length)for(var a in data.global_v_names){var b=data.global_v_names[a];model_shown_v.push("arr"!=b.type||b.isCollapsed?b:b)}construct_cnodes(),create_links()}function generate_nodes_from_array(a,b){if(1===b.length)for(var c=1;c<=b[0];c++)model_shown_v.push({name:a+c+"]"});else{b.shift();for(var d=1;d<=b[0];d++)generate_nodes_from_array(a+d+",",b)}}function construct_cnodes(){var a,b={};data.constraint_nodes=[];for(var c in data.constraints){var d={name:"",arr:{}},e=data.constraints[c];d.type=e.name,d.name=e.name;for(var f in e.arr){a=e.arr[f].host&&e.arr[f].host.isCollapsed?e.arr[f].host.name:e.arr[f].name;var g=data.global_v_names[a];g||(g=data.all_v[a]),d.arr[a]=g,d.name+="_"+a,e.cnode=d}b[d.name]=d}for(var h in b)data.constraint_nodes.push(b[h])}function create_links_o2(){for(var a in data.constraints)for(var b=data.constraints[a],c=0;c<b.arr.length;c++)for(var d=c+1;d<b.arr.length;d++){var e={type:"straight",source:b.arr[c],length:5};e.target=b.arr[d],e.real_target=b.arr[d],model_links.push(e)}}function create_links(){for(var a in data.constraint_nodes){var b=data.constraint_nodes[a];for(var c in b.arr){var d={type:"straight",source:b,length:2};b.arr[c].host?(d.target=b.arr[c].host,b.arr[c].host.isCollapsed===!1?(d.real_target=b.arr[c],d.length=8):d.real_target=b.arr[c].host):d.target=d.real_target=b.arr[c],model_links.push(d)}}}function Tools(){}Data.Profiling=!0,Data.prototype.readNogoodsFile=function(a,b){var c=new XMLHttpRequest,d=a;d+="?noCache="+(new Date).getTime()+Math.random(),c.open("get",d,!1),c.onload=function(a){return function(){a._parseNoGoods.apply(a,[arguments[0],b])}}(this),c.send()},Data.prototype._parseNoGoods=function(a){var b=a.target.response.trim().replace(/[ ]{2,}/gi," "),c=b.split("\n");read_variables(c),read_varlits(c),read_clauses(c),generate_vars(),generate_graph(),apply_graph(),de.draw()},Data.prototype.readFile=function(a,b){var c=new XMLHttpRequest,d=a;d+="?noCache="+(new Date).getTime()+Math.random(),c.open("get",d,!1),c.onload=function(a){return function(){a._initModel.apply(a,[arguments[0],b])}}(this),c.send()},Data.prototype._initModel=function(a,b){Data.Profiling&&console.time("Parsing time: ");var c=a.target.response.trim().split("\n");this._parseVariables(c.filter(Data._isSingleVar).filter(Data._isVariable)),this._parseArrays(c.filter(Data._isArray).filter(Data._isVariable)),this._parseConstraints(c.filter(Data._isConstraint)),this._loopConstraints(),this._removeRedundancy(),this._applyAliases(),Data.Profiling&&console.timeEnd("Parsing time: "),b()},Data.prototype.readString=function(a,b){var c=a.trim().split("\n");this._parseVariables(c.filter(Data._isSingleVar).filter(Data._isVariable)),this._parseArrays(c.filter(Data._isArray).filter(Data._isVariable)),this._parseConstraints(c.filter(Data._isConstraint)),this._loopConstraints(),this._removeRedundancy(),b()},Data._isVariable=function(a){return-1!==a.split(" ").indexOf("var")?!0:!1},Data._isSingleVar=function(a){return"var"===a.split(" ")[0]?!0:!1},Data._isArray=function(a){return"array"===a.split(" ")[0]?!0:!1},Data._isConstraint=function(a){return"constraint"===a.split(" ")[0]?!0:!1},Data.prototype._parseConstraints=function(a){Data.LogParsing&&console.groupCollapsed("Constraint Strings");for(var b=0;b<a.length;b++){Data.LogParsing&&console.log("parsed constraints: ",a[b]);var c=Data._parseConstraint(a[b]);this.constraints.push(c)}Data.LogParsing&&console.groupEnd()},Data._parseConstraint=function(a){var b={name:"",arr:[]},a=a.substring("constraint ".length),c=a.indexOf("("),d=a.indexOf(")");if(b.name=a.substring(0,c),a=a.substring(c+1,d).trim(),"["===a.charAt(0)&&"]"===a.charAt(a.length-1))a=a.substring(1,a.length-1);else{var e=Tools.smart_split(a);"int_lin_eq"===b.name?a=Tools.removeOuterBraces(e[1]):"int_lin_eq_reif"===b.name?a=Tools.removeOuterBraces(e[1])+", "+Tools.smart_split(e[3])[0]:"array_bool_and"===b.name&&(a=Tools.removeBraces(a))}var f=a.replace(/[ ]{1,}/gi,"").split(",");return b.arr="int_eq"===b.name?[f[0]]:f,b},Data.prototype._applyAliases=function(){for(var a in this.constraints){var b=this.constraints[a];for(var c in b.arr){var d=this.constraints[a].arr[c];void 0!==this.var_aliases[d.name]&&(console.log("applied aliases!"),this.constraints[a].arr[c]=this.all_v[this.var_aliases[d.name]])}}},Data.prototype._loopConstraints=function(){for(var a=0;a<this.constraints.length;a++){Data.LogParsing&&console.log("Looping constraint: ",this.constraints[a]);for(var b=this.constraints[a],c=0;c<b.arr.length;c++){var d=this.all_v[b.arr[c]];if(d)d.constraints.push(b),d.host&&d.host.constraints.push(b),b.arr[c]=d;else{if(d=this.global_v_names[b.arr[c]],!d){b.arr.splice(c,1),c--;continue}for(e in d.vars)d.vars[e].constraints.push(b),d.vars[e].host.constraints.push(b);b.arr=d.vars,c+=d.vars.length}}}},Data.prototype._removeRedundancy=function(){for(var a=0;a<this.constraints.length;a++){var b=this.constraints[a];"bool2int"===b.name&&(this._collapseVariables(b.arr[0],b.arr[1]),delete this.constraints[a])}},Data.prototype._collapseVariables=function(a,b){b.alias=a.name,console.log("v1: ",a),console.log("v2: ",b);for(var c=0;c<a.constraints.length;c++)b.constraints.push(a.constraints[c]);for(var c=0;c<b.constraints.length;c++){var d=b.constraints[c];"bool2int"===d.name&&(d.arr[0].name===a.name&&d.arr[1].name===b.name||d.arr[0].name===b.name&&d.arr[1].name===a.name)&&(this.var_aliases[a.name]=b.name,console.log("removing: ",b.constraints[c]),b.constraints.splice(c--,1))}this.global_v_names[a.name]=b,this.all_v[a.name]=b},Data.prototype._parseVariables=function(a){for(var b=0;b<a.length;b++){Data.LogParsing&&console.log("parsed varialbes: ",a[b]);var c={};c.name=a[b].substring(a[b].indexOf(":")+1).match(/[a-zA-z_0-9]+/)[0],c.constraints=[],c.type=-1!==a[b].indexOf("introduced")?"svar":"svar",this.global_v_names[c.name]=c,c.isCollapsed=!0,this.all_v[c.name]=c}},Data.prototype._parseArrays=function(a){for(var b=0;b<a.length;b++){Data.LogParsing&&console.log("parsed arrays: ",a[b]);var c={},d=Tools.parse_array_str(a[b]),e=-1===a[b].indexOf("::")?!1:!0,f=a[b].substring(a[b].indexOf(":")+1).trim();c.name=f.match(/[a-zA-z_0-9]*/)[0],c.type="arr",c.isCollapsed=!0,c.constraints=[],c.vars=[];var g=f.indexOf("("),h=f.indexOf(")");if(-1!==f.indexOf("=")||d[1]&&-1===d[1].indexOf("..")){f=f.substring(f.indexOf("=")),c.dims=1,g=f.indexOf("["),h=f.indexOf("]"),f=f.substring(g+1,h);for(var i=f.replace(/[ ]{1,}/gi,"").split(","),j=0;j<i.length;j++){var k=this.all_v[i[j]];this.var_aliases[k.name]=c.name+"["+j+"]",delete this.global_v_names[k.name],k.host=c,k.real_name=k.name,k.name=c.name+"["+j+"]",k.constraints=[],c.vars.push(k)}c.n=[i.length]}else{f=e?f.substring(g+2,h-1):d[0];var l=f.split(",");c.dims=l.length,c.n=[];for(var m=1,n=0;n<l.length;n++)c.n[n]=parseInt(l[n].match(/[0-9]*$/)[0],10),m*=c.n[n];for(var o=1;m>=o;o++){var p=c.name+"["+o+"]",q={host:c,name:p,constraints:[]};c.vars.push(q),this.all_v[p]=q}}2===c.dims?(c.w=(DrawingEngine.PADDING+DrawingEngine.VAR_SIZE)*c.n[1]+DrawingEngine.PADDING,c.h=(DrawingEngine.PADDING+DrawingEngine.VAR_SIZE)*c.n[0]+DrawingEngine.PADDING):1===c.dims&&(c.w=(DrawingEngine.PADDING+DrawingEngine.VAR_SIZE)*c.n[0]+DrawingEngine.PADDING,c.h=DrawingEngine.PADDING+DrawingEngine.VAR_SIZE),this.global_v_names[c.name]=c}},DrawingEngine.VAR_SIZE=20,DrawingEngine.PADDING=5,DrawingEngine.ARR_SIZE=30,DrawingEngine.C_SIZE=12,DrawingEngine.log_svg_elements=!1,DrawingEngine.log_hover=!0,DrawingEngine.allow_drag=!0,DrawingEngine.draw_singles=!1,DrawingEngine.counter=0;var v_nodes,c_nodes,a_nodes,exp_a_nodes,s_links,q_link,two_dim_array_e,min_a_btns,transform={dx:0,dy:0,scale:1},old_d3_translate=[0,0],nodeMouseDown=!1;DrawingEngine.prototype.init_svg=function(){this.svg||(this.svg=d3.select("#content").append("svg").attr("width",this.width).attr("height",this.height).attr("id","svg").call(d3.behavior.zoom().on("zoom",function(a){return function(){a._apply_zooming.apply(a,arguments)}}(this))),this.vis=this.svg.append("g"),this.edgesLayer=this.vis.append("g"),this.nodesLayer=this.vis.append("g"),this.buttonsLayer=this.vis.append("g"))},DrawingEngine.prototype._apply_zooming=function(){nodeMouseDown||(transform.dx+=d3.event.translate[0]-old_d3_translate[0],transform.dy+=d3.event.translate[1]-old_d3_translate[1],transform.scale=d3.event.scale,this.vis.attr("transform","translate("+[transform.dx,transform.dy]+") scale("+transform.scale+")")),old_d3_translate[0]=d3.event.translate[0],old_d3_translate[1]=d3.event.translate[1]},DrawingEngine.prototype.draw=function(){var a=DrawingEngine._filter_single_nodes();this.cola_obj.nodes(a).links(cola_links).start(5,5,5),this._draw_single_variables(a),this._draw_array_nodes(a),this._draw_expanded_arrays(a),this._draw_constraint_nodes(),this._draw_links(),DrawingEngine._update_highlighting(),this.cola_obj.on("tick",function(a){return function(){a._update_drawing.apply(a,arguments)}}(this))},DrawingEngine._filter_single_nodes=function(){return shown_v.forEach(function(a){a.has_links=!1}),cola_links.forEach(function(a){a.target.has_links=a.source.has_links=!0}),shown_v.filter(function(a){return a.has_links})},DrawingEngine._draw_var_list=function(){var a=shown_v.filter(function(a){return a.isHighlighted===!0}),b=d3.select("#var_names").selectAll("p").data(a,function(a){return a.name});b.enter().append("p").text(function(a){return a.name}),b.exit().remove()},DrawingEngine._update_highlighting=function(){var a=shown_v;a.forEach(function(a){if(a.isHighlighted){DrawingEngine.highlight_svg_element(a);var b=vLayout.model_nodes[a.name];void 0!==b&&DrawingEngine.highlight_svg_element(b)}else d3.select(a.svg_element).style("fill",function(){return"rgba(255, 255, 255, 1)"}),vLayout.isReady&&d3.select(vLayout.model_nodes[a.name]).attr("style",function(a){return"fill: "+VarLayout.getRightColor(a)})}),vLayout.isReady&&vLayout.mark_hidden()},DrawingEngine._highlight_neighbours=function(a){links.forEach(function(b){b.source!==a||b.target.isHighlighted?b.target!==a||b.source.isHighlighted||DrawingEngine.highlight_svg_dimly(b.source):DrawingEngine.highlight_svg_dimly(b.target)})},DrawingEngine.prototype._draw_single_variables=function(a){v_nodes=this.nodesLayer.selectAll(".v_node").data(a.filter(function(a){return"svar"===a.type}),function(a){return a.name}),v_nodes.enter().append("circle").attr("class","v_node").attr("r",DrawingEngine.VAR_SIZE/2).each(function(a){a.svg_element=this}).on("click",function(a){DrawingEngine.toggle_highlight_var(a),DrawingEngine._highlight_neighbours(a)}).on("mousedown",function(){nodeMouseDown=!0,console.log("mouse down")}).on("mouseup",function(){nodeMouseDown=!1,console.log("mouse up")}).on("mouseover",function(a){DrawingEngine._highlight_neighbours(a)}).on("mouseleave",function(){DrawingEngine._update_highlighting()}).append("title").text(function(a){return a.name}),DrawingEngine.allow_drag&&v_nodes.call(this.cola_obj.drag),v_nodes.exit().remove()},DrawingEngine.prototype._draw_constraint_nodes=function(){c_nodes=this.nodesLayer.selectAll(".c_node").data(data.constraint_nodes),c_nodes.each(function(a){a.svg_element=this}),c_nodes.enter().append("path").attr("class","c_node").on("mouseover",function(a){DrawingEngine.log_hover&&console.log("%cc_node: ","color: orange",a),DrawingEngine.highlight_cnode(a)}).on("mouseleave",function(){DrawingEngine.set_all_unhighlighted()}).each(function(a){a.svg_element=this,console.log("we do draw cnodes")}).append("title").text(function(a){return a.type}),c_nodes.exit().remove()},DrawingEngine.highlight_cnode=function(a){a.cnode&&(a.cnode.isHighlighted=!0);for(var b in a.arr)a.arr[b].svg_element&&("svar"===a.arr[b].type||"arr"===a.arr[b].type&&a.arr[b].isCollapsed||"array_element"===a.arr[b].type&&!a.arr[b].host.isCollapsed)&&(a.arr[b].isHighlighted=!0)},DrawingEngine.highlight_var=function(a){a.isHighlighted=!0},DrawingEngine.toggle_highlight_var=function(a){void 0===a.isHighlighted||a.isHighlighted===!1?DrawingEngine.highlight_var(a):a.isHighlighted=!1,DrawingEngine._update_highlighting(),DrawingEngine._draw_var_list()},DrawingEngine.highlight_svg_element=function(a){var b=void 0===a.svg_element?a:a.svg_element;d3.select(b).attr("style",function(){return"fill: gold"})},DrawingEngine.unhighlight_svg_element=function(a){var b=void 0===a.svg_element?a:a.svg_element;d3.select(b).attr("style",function(){return"fill: whilte"})},DrawingEngine.clear_selection=function(){DrawingEngine.set_all_unhighlighted(),DrawingEngine._update_highlighting(),DrawingEngine._draw_var_list()},DrawingEngine.highlight_svg_dimly=function(a){d3.select(a.svg_element).attr("style",function(){return"fill: Lavender"})},DrawingEngine._unhighlight_all=function(){d3.selectAll(".two_dim_array_e").attr("style",function(){return"fill: rgba(255, 255, 255, 1)"}),d3.selectAll(".c_node").attr("style",function(){return"fill: rgba(255, 0, 0, 1)"}),d3.selectAll(".a_node").attr("style",function(){return"fill: rgba(255, 255, 255, 1)"}),d3.selectAll(".v_node").attr("style",function(){return"fill: rgba(255, 255, 255, 1)"})},DrawingEngine.set_all_unhighlighted=function(){console.log("setting unhighlighted"),shown_v.forEach(function(a){a.isHighlighted=!1,a.isHighlightedDimly=!1})},DrawingEngine.prototype._draw_array_nodes=function(a){DrawingEngine.log_svg_elements&&console.group("A_NODES"),a_nodes=this.nodesLayer.selectAll(".a_node").data(a.filter(function(a){return"arr"===a.type&&a.isCollapsed===!0}),function(a){return a.name});var b=a_nodes.enter();a_nodes.each(function(a){a.svg_element=this}),b.append("rect").attr("class","a_node").attr("width",DrawingEngine.ARR_SIZE).attr("height",DrawingEngine.ARR_SIZE).each(function(a){a.svg_element=this,DrawingEngine.log_svg_elements&&console.log("%c+ a_node created:","color: blue",a,"with svg: ",this),this.aaa_id||(this.aaa_id=++DrawingEngine.counter)}).on("mouseover",function(a){DrawingEngine.highlight_var(a)}).on("mouseleave",function(){DrawingEngine.unhighlight_all()}).attr("aaa_id",DrawingEngine.counter).on("click",function(a){expand_node(a)}).append("title").text(function(a){return a.name}),a_nodes.exit().each(function(a){DrawingEngine.log_svg_elements&&console.log("%c- a_node removed:","color: brown",a,"with svg: ",this)}).remove(),DrawingEngine.log_svg_elements&&console.groupEnd()},DrawingEngine.prototype._draw_expanded_arrays=function(a){DrawingEngine.log_svg_elements&&console.group("EXPANDED_A_NODES"),exp_a_nodes=d3.selectAll(".exp_a_node").data(a.filter(function(a){return"arr"===a.type&&a.isCollapsed===!1}),function(a){return a.name}),this.nodesLayer.selectAll(".exp_a_node").each(function(a){a.svg_element=this}),exp_a_nodes.enter().append("rect").attr("class","exp_a_node").attr("width",function(a){return 2===a.dims?a.width=a.n[1]*(DrawingEngine.VAR_SIZE+DrawingEngine.PADDING)-DrawingEngine.PADDING:1===a.dims?a.width=a.n[0]*(DrawingEngine.VAR_SIZE+DrawingEngine.PADDING)-DrawingEngine.PADDING:void 0}).attr("height",function(a){return 2===a.dims?a.height=a.n[0]*(DrawingEngine.VAR_SIZE+DrawingEngine.PADDING)-DrawingEngine.PADDING:1===a.dims?a.height=DrawingEngine.VAR_SIZE:void 0}).each(function(a){DrawingEngine.log_svg_elements&&console.log("%c+ expanded_a_node created:","color: blue",a,"with svg: ",this),this.aaa_id=++DrawingEngine.counter,a.svg_element=this}).attr("aaa_id",DrawingEngine.counter).append("title").text(function(a){return a.name}),exp_a_nodes.exit().each(function(a){DrawingEngine.log_svg_elements&&console.log("%c- exp_a_node removed:","color: brown",a)}).remove();var b=[];d3.selectAll(".exp_a_node").each(function(a){var c,d;if(2===a.dims)for(console.log("array_vars: ",a.vars),c=0;c<a.n[0];c++)for(var e=0;e<a.n[1];e++)d=a.vars[c*a.n[1]+e],d.i=c,d.j=e,d.host=a,d.real_name||(d.real_name=a.name+"["+(c+1)+", "+(e+1)+"]"),b.push(d);else if(1===a.dims)for(c=0;c<a.n[0];c++)d=a.vars[c],d.i=0,d.j=c,d.host=a,d.real_name||(d.real_name=a.name+"["+(c+1)+"]"),b.push(d)}),two_dim_array_e=this.nodesLayer.selectAll(".two_dim_array_e").data(b,function(a){return a.name}),two_dim_array_e.enter().append("rect").attr("class","two_dim_array_e").attr("width",DrawingEngine.VAR_SIZE).attr("height",DrawingEngine.VAR_SIZE).on("mouseover",function(a){DrawingEngine.highlight_var(a)}).on("mouseleave",function(){DrawingEngine.set_all_unhighlighted()}).each(function(a){a.svg_element=this,a.type="array_element"}).append("title").text(function(a){return a.real_name}),two_dim_array_e.exit().remove(),two_dim_array_e=this.nodesLayer.selectAll(".two_dim_array_e"),min_a_btns=this.nodesLayer.selectAll(".min_a_btn").data(a.filter(function(a){return"arr"===a.type&&a.isCollapsed===!1}),function(a){return a.name}),min_a_btns.enter().append("rect").attr("class","min_a_btn").attr("width",DrawingEngine.VAR_SIZE/2).attr("height",DrawingEngine.VAR_SIZE/2).attr("rx","3px").attr("ry","3px").on("click",function(a){collapse_node(a)}),min_a_btns.exit().remove(),min_a_btns=this.nodesLayer.selectAll(".min_a_btn"),DrawingEngine.log_svg_elements&&console.groupEnd()},DrawingEngine.prototype._draw_links=function(){s_links=this.edgesLayer.selectAll(".straight_link").data(links),s_links.enter().append("line").attr("class","straight_link"),s_links.exit().remove()},DrawingEngine.prototype._update_drawing=function(){v_nodes.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),a_nodes.attr("x",function(a){return a.x-DrawingEngine.ARR_SIZE/2}).attr("y",function(a){return a.y-DrawingEngine.ARR_SIZE/2}),exp_a_nodes.attr("x",function(a){return a.x-a.width/2}).attr("y",function(a){return a.y-a.height/2}),min_a_btns.attr("x",function(a){return a.x+a.width/2-5}).attr("y",function(a){return a.y-a.height/2-5}),two_dim_array_e.attr("x",function(a){return a.x=a.host.x+(DrawingEngine.VAR_SIZE+DrawingEngine.PADDING)*a.j-a.host.w/2+DrawingEngine.VAR_SIZE/2,a.x-DrawingEngine.PADDING}).attr("y",function(a){return a.y=a.host.y+(DrawingEngine.VAR_SIZE+DrawingEngine.PADDING)*a.i-a.host.h/2+DrawingEngine.VAR_SIZE/2,a.y-DrawingEngine.PADDING}),c_nodes.attr("d",function(a){var b=16;return"M "+a.x+" "+(a.y-b/2)+" l "+b/2+" "+b+" l "+-b+" 0 z"}),s_links.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.real_target.x}).attr("y2",function(a){return a.real_target.y})},VarLayout.DISTANCE=10,NODE_SIZE=10,ELEMENT_DISTANCE=5,ARR_COLOR="moccasin",INT_ARR_COLOR="green",VarLayout.prototype.mark_hidden=function(){for(var a=0;a<shown_v.length;a++){var b=shown_v[a];b.has_links||d3.select(vLayout.model_nodes[b.name]).attr("style",function(){return"stroke: lightgrey"})}VarLayout.applyColors()},VarLayout.applyColors=function(){shown_v.filter(function(a){return a.has_links}).forEach(function(a){d3.select(vLayout.model_nodes[a.name]).attr("style",function(){return"fill: "+VarLayout.getRightColor(a)})})},VarLayout.prototype.init=function(){this.svg=d3.select("#v_layout").append("svg").attr("height",this.height),this.vis=this.svg.append("g").attr("class","vlayout_vis"),this.svg.call(d3.behavior.zoom().on("zoom",function(a){return function(){a._apply_zooming.apply(a,arguments)}}(this)))},VarLayout.prototype._apply_zooming=function(){nodeMouseDown||this.vis.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")},VarLayout.prototype.update_drawing=function(){var a=Data._self.global_v_names;d3.selectAll(".vl_node").remove(),d3.selectAll(".vl_label").remove();var b=VarLayout.DISTANCE+rel_x,c=VarLayout.DISTANCE+rel_y;for(i in a){var d=a[i];if(d.x=b,d.y=c,"var"==d.type)c=this.draw_var(d,b,c);else if("arr"==d.type)switch(VarLayout._drawLabel(this.vis,d.name,b,c),d.n.length){case 1:c=this.draw_one_dim_array(d,b,c);break;case 2:c=this.draw_two_dim_array(d,b,c);break;case 3:c=this.draw_three_dim_array(d,b,c)}}this.mark_hidden()},VarLayout._drawLabel=function(a,b,c,d){a.append("text").attr("x",c-NODE_SIZE/2).attr("y",d).attr("class","vl_label").text(b)},VarLayout._getRelPosition=function(){},VarLayout.prototype._put_node=function(a,b,c){b-=NODE_SIZE/2,c-=NODE_SIZE/2;var d=this.vis.append("rect").attr("class","vl_node").attr("width",NODE_SIZE).attr("height",NODE_SIZE).attr("x",b).attr("y",c);d[0][0].addEventListener("click",function(a){var b=a.target.variable;DrawingEngine.toggle_highlight_var(b)}),this.model_nodes[a]=d[0][0],d[0][0].variable=var_map[a]},VarLayout.getRightColor=function(a){if(void 0===a)return"white";var b=.1+Math.sqrt((a.occurs-min_occurrence)/(max_occurrence-min_occurrence)),c="rgba(25,25,255,"+b+")";return console.log(c),c},VarLayout.prototype.draw_one_dim_array=function(a,b,c){this.vis;c+=NODE_SIZE;for(var d=0;d<a.n[0];d++){var e=a.name+"["+(d+1)+"]";this._put_node(e,b,c),b+=NODE_SIZE+ELEMENT_DISTANCE}return c+=NODE_SIZE+1.5*VarLayout.DISTANCE},VarLayout.prototype.draw_two_dim_array=function(a,b,c){var d=(this.vis,b);c+=NODE_SIZE;for(var e=0;e<a.n[1];e++){for(var f=0;f<a.n[0];f++){var g=a.name+"["+(e*a.n[0]+f+1)+"]";this._put_node(g,b,c),b+=NODE_SIZE+ELEMENT_DISTANCE}c+=NODE_SIZE+ELEMENT_DISTANCE,b=d}return c+=1.5*VarLayout.DISTANCE-ELEMENT_DISTANCE},VarLayout.prototype.draw_three_dim_array=function(a,b,c){this.vis;c+=NODE_SIZE;for(var d=b,e=c,f=0;f<a.n[0];f++){for(var g=0;g<a.n[1];g++){for(var h=0;h<a.n[2];h++){var i=a.name+"["+(f*a.n[1]*a.n[2]+g*a.n[2]+h+1)+"]";this._put_node(i,b,c),b+=NODE_SIZE+ELEMENT_DISTANCE}c+=NODE_SIZE+ELEMENT_DISTANCE,g==a.n[1]-1&&(this.horizontally?d+=a.n[2]*(NODE_SIZE+ELEMENT_DISTANCE)+VarLayout.DISTANCE:c+=VarLayout.DISTANCE),b=d}this.horizontally?c=e:b=d}return e+a.n[1]*(NODE_SIZE+ELEMENT_DISTANCE)-ELEMENT_DISTANCE+1.5*VarLayout.DISTANCE};var vLayout=new VarLayout,DEFAULT_EDGE_LENGTH=10,var_map={},variables,map_varlits,map_var_name,links_map={},nogood_shown_v=[],nogood_links=[],SCALE_FACTOR=1.1,scale=1,rel_x=0,rel_y=0,me_prev_x=-1,me_prev_y=-1;window.addEventListener("load",init);var data=new Data,de=new DrawingEngine,isRunInBrouser=!0,vLayout,model_shown_v=[],links=[],cola_links=[],shown_v=[],model_links=[],diff_links=[],difference_graph=!1,max_occurrence,min_occurrence;DragRect.content_mdown=function(a){console.log(a),a.shiftKey&&(nodeMouseDown=!0,document.addEventListener("mousemove",DragRect.update)),DragRect.x=a.layerX,DragRect.y=a.layerY},DragRect.update=function(a){DragRect.draw_rect(DragRect.x,a.layerX,DragRect.y,a.layerY)},DragRect.draw_rect=function(a,b,c,d){a>b&&(a=[b,b=a][0]),c>d&&(c=[d,d=c][0]),d3.select(".drag_rect").remove(),de.svg.append("rect").attr("x",a).attr("y",c).attr("class","drag_rect").attr("width",Math.abs(a-b)).attr("height",Math.abs(c-d))},DragRect.content_mup=function(a){a.shiftKey&&(nodeMouseDown=!1,capture_nodes(DragRect.x,DragRect.y,a.layerX,a.layerY)),document.removeEventListener("mousemove",DragRect.update),d3.select(".drag_rect").remove()},Tools.parse_array_str=function(a){c=0,start=0,open_count=0,closed_count=0;for(var b=[],c=0;c<a.length;c++){var d=!1;"["===a[c]?(open_count++,1===open_count&&(start=c),open_count>1&&(d=!0)):"]"===a[c]&&closed_count++,0!==closed_count&&open_count===closed_count&&(b.push(d?parse_array_str(a.substring(start+1,c)):a.substring(start+1,c)),open_count=0,closed_count=0)}return b},Tools.smart_split=function(a){c=0,start=0,open_count=0,closed_count=0;for(var b=[],c=0;c<a.length;c++)"["===a[c]?open_count++:"]"===a[c]?closed_count++:","===a[c]&&open_count===closed_count&&(b.push(a.substring(start,c)),start=c+1);return b.push(a.substring(start)),b},Tools.removeBraces=function(a){return a.replace(/[\]\[]{1,}/gi,"")},Tools.removeOuterBraces=function(a){var a=a.match(/\[.+\]/)[0];return a.substring(1,a.length-1)};